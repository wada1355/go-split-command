# 概要
macOSやLinuxに標準搭載されているsplitコマンドを、goで自作した。

# 対応したオプション

-l（行数で分割）, -n（ファイル数で分割）, -b（バイト数で分割）オプションに対応した。
何もオプションが選択されない場合は、macOSのsplitコマンドと同じく1000行ごとに分割されるようにした。

# 対応したイレギュラーな入力

ファイル、オプションごとに専用のバリデーション関数を作成し、以下のような観点をチェックするようにした。

## ファイル

- ファイルを1つだけ指定しているか（ファイルが指定されていなかったり、2つ以上指定されていないか）
- ファイルは存在するか
- 空ファイルではないか

## オプション

- オプションは1つだけ指定しているか
- オプションの数値は正の数であるか
- オプションが何も指定されなかった場合はデフォルト値を用いる

# パフォーマンス

バッファリングを利用して、I/O操作の回数を最小限にした。これにより単純なパフォーマンス向上と、大きなファイルでも扱えるようになった。
また、あえて並行処理は採用しなかった。試しに実装してみたが、I/O処理が多いのもあってかほとんどスピードは上がらなかった。並行処理を導入することによって増すコードの複雑性に対して得られる利益が割に合わなかったため、並行処理の導入は見送った。

# テストコード

以下のような観点を工夫した。

## 実際に軽量のファイルを用いてテストする

仕様上、ファイル操作がコアな機能であり、かつテストの総量も膨大なものではないため、本物のファイルを使って実際の挙動と同じ条件でテストを実行した。テスト開始時に使用するファイルが作成され、テスト終了後に作成された全てのファイルが削除されるようにしている。

## TestMain関数の利用

TestMain関数に、テストに共通する初期化やクリーンアップのコードを記述し、コードをDRYにした。
また、このテストに必要なフロー（前処理→ユニットテスト→後処理）が理解しやすく、可読性を向上させることもできた。

## テーブル駆動テストの実践

テーブル駆動テストを導入し、以下の利益を得た。

- テスケースを簡単に追加できる
- 可読性の向上

## 豊富なテストケース

正常系はもちろん、準正常系、境界値など複数パターンのテストを実施した。
カバレッジは以下の通り。
[github.com/wata1355/go-split-command/fileop](http://github.com/wata1355/go-split-command/fileop)     0.327s  coverage: 80.6% of statements 
[github.com/wata1355/go-split-command/splitters](http://github.com/wata1355/go-split-command/splitters)  0.704s  coverage: 74.6% of statements 
[github.com/wata1355/go-split-command/validators](http://github.com/wata1355/go-split-command/validators) 0.505s  coverage: 93.3% of statements 

# 設計関連

以下のような観点を工夫した

- main.goに複雑な処理やロジックは書かない
- パッケージ、ファイル、関数に対して単一責任の原則を適用
- エラーが発生した場合、関数はエラーを返して呼び出し元が適切に対処する
- 構造体に関数を紐付け、引数への依存を少なくする
- 費用対効果の高いテストを書く（パブリックな関数のみテストするようにした）
